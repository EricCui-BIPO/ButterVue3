# 人才管理系统产品需求文档 (PRD)

## 1. 概述

### 1.1 问题背景
随着企业全球化发展，员工数据分布在不同的地理区域，需要遵循各地的数据隐私法规。现有系统无法有效管理多区域员工数据，缺乏灵活的字段扩展机制，且法规合规性提示不足。

### 1.2 目标用户
- **HR 用户**：企业人力资源管理人员，负责员工信息管理
- **平台管理员**：系统管理人员，负责字段配置和系统维护
- **平台服务人员 (SD)**：需要跨客户查看员工数据的技术支持人员

### 1.3 项目上下文
系统采用多区域部署架构，在德国（欧洲）、新加坡（东南亚）、宁夏（中国）分别部署服务器，存储对应区域的员工隐私数据，同时同步脱敏数据至所有服务器以确保数据可用性。

## 2. 项目目标

1. **统一管理**：建立统一的员工信息管理平台，支持多区域数据存储和访问
2. **灵活扩展**：支持基于国家和项目的动态字段配置
3. **合规提醒**：在访问员工详情时提供相关法律法规提示
4. **权限控制**：实现基于角色的数据访问控制
5. **搜索效率**：提供强大的员工搜索和过滤功能/

## 3. 用户故事

### 用户故事 1：HR 查看员工列表
作为 HR，我可以在 Client 端的 talent 页面上查看所有 Employee 的基本信息，包括头像、姓名、员工工号、工作地、国籍、邮箱、部门、岗位、入职日期、离职日期、数据库存储服务器。

### 用户故事 2：HR 搜索过滤员工
作为 HR，我可以在 Client 端的 talent 页面上根据姓名、员工工号、工作地、国籍、部门、入职日期范围、离职日期范围、数据库存储服务器来搜索和过滤 Employee 的列表，以快速找到需要的人员。

### 用户故事 3：HR 创建编辑员工
作为 HR，我可以在 client 端的 talent 页面上创建、编辑 employee。由于员工存储在不同的数据库存储服务器，会遵循当地的法律法规，所以会提示用户当前数据库存储服务器的相关法律法规。每个工作地国家都有通用 employer 字段和国家特有的字段组成。

### 用户故事 4：HR 查看员工详情
作为 HR，我可以在 client 端的 talent 页面上点击某一个 employee，可以进入到详情查看页面查看 employee 详情。由于员工存储在不同的数据库存储服务器，会遵循当地的法律法规，所以会提示用户当前数据库存储服务器的相关法律法规。

### 用户故事 5：管理员字段管理
作为管理员，我可以在 admin 端的 Employee field 管理页面维护各个国家特有的字段。

## 4. 功能需求 (FR)

### FR-1: 员工列表查看
**描述**：提供员工列表展示功能，显示员工的基本信息。

**详细需求**：
- 展示字段：头像、姓名、员工工号、工作地、国籍、邮箱、部门、岗位、入职日期、离职日期、数据库存储服务器
- 支持分页显示，默认每页 20 条记录
- 支持按不同字段排序
- 数据为脱敏后的员工信息

### FR-2: 员工搜索与过滤
**描述**：提供多条件搜索和过滤功能，快速定位目标员工。

**详细需求**：
- 搜索条件：姓名、员工工号、工作地、国籍、部门、入职日期范围、离职日期范围、数据库存储服务器
- 支持多条件组合查询
- 支持模糊搜索和精确匹配
- 保存用户的搜索条件偏好

### FR-3: 员工创建与编辑
**描述**：支持员工信息的创建和编辑功能，包含通用字段和条件字段。

**详细需求**：
- 通用字段：姓名、员工工号、工作地、国籍、邮箱、部门、岗位、入职日期、离职日期、数据库存储服务器
- 条件字段：基于国家或项目的动态字段（如中国身份证号、美国社会安全号码、新加坡 CPF 号码）
- 在保存前显示相关法律法规提示
- 支持员工信息的批量导入

### FR-4: 员工详情查看
**描述**：提供员工详细信息查看功能，包含法律法规提示。

**详细需求**：
- 显示员工完整信息（包括脱敏和敏感信息）
- 根据员工数据存储位置显示相关法律法规提示
- 需要用户授权才能查看敏感信息
- 记录敏感信息访问日志

### FR-5: 条件字段管理
**描述**：提供管理员界面，维护各个国家特有的条件字段。

**详细需求**：
- 支持基于国家和项目的条件字段配置
- 支持字段的增删改查操作
- 支持字段类型和验证规则配置
- 支持条件字段的启用/禁用状态管理

## 5. 验收标准 (AC)

### AC-1.1: 员工列表展示
- ✅ 列表页面正确显示所有指定字段
- ✅ 分页功能正常工作，每页显示 20 条记录
- ✅ 支持点击表头进行升序/降序排序
- ✅ 显示的数据为脱敏后的员工信息
- ✅ 列表加载时间不超过 3 秒

### AC-1.2: 列表数据权限
- ✅ HR 用户只能看到自己客户的员工数据
- ✅ 平台 SD 可以看到所有客户的脱敏员工数据
- ✅ 无权限用户无法访问员工列表

### AC-2.1: 基础搜索功能
- ✅ 支持按姓名、员工工号进行模糊搜索
- ✅ 支持按工作地、国籍、部门进行精确匹配
- ✅ 支持日期范围选择器
- ✅ 搜索响应时间不超过 2 秒

### AC-2.2: 高级过滤功能
- ✅ 支持多条件组合查询
- ✅ 支持条件的添加和删除
- ✅ 支持搜索条件的保存和加载
- ✅ 过滤结果准确无误

### AC-3.1: 员工创建功能
- ✅ 创建表单包含所有必需字段
- ✅ 根据选择的国家动态显示条件字段
- ✅ 保存前显示法律法规提示
- ✅ 创建成功后显示在员工列表中

### AC-3.2: 员工编辑功能
- ✅ 支持员工信息的编辑和更新
- ✅ 保留字段修改历史记录
- ✅ 敏感字段修改需要额外授权
- ✅ 编辑后数据正确同步到对应服务器

### AC-4.1: 员工详情查看
- ✅ 详情页面显示员工完整信息
- ✅ 首次访问时显示法律法规提示
- ✅ 敏感信息需要用户授权才能查看
- ✅ 记录所有敏感信息访问日志

### AC-4.2: 法律法规提示
- ✅ 根据员工数据存储位置显示对应法规
- ✅ 提示内容准确且易于理解
- ✅ 用户可以确认或取消访问
- ✅ 法规提示可配置和更新

### AC-5.1: 条件字段管理
- ✅ 管理员可以访问字段管理页面
- ✅ 支持基于国家和项目的字段配置
- ✅ 支持字段的增删改查操作
- ✅ 字段配置实时生效

### AC-5.2: 字段验证规则
- ✅ 支持多种字段类型（文本、数字、日期等）
- ✅ 支持字段验证规则配置
- ✅ 支持字段必填性设置
- ✅ 验证规则实时生效

## 6. 非目标范围

### 6.1 本次迭代不包含的功能
- 员工薪资管理
- 员工考勤管理
- 员工绩效评估
- 组织架构管理
- 报表生成和分析

### 6.2 技术限制
- 不支持实时数据同步（采用定时同步）
- 不支持离线模式
- 不支持移动端适配

## 7. 设计考量

### 7.1 规范对应关系
- 严格遵循 Clean Architecture + DDD 分层架构
- 使用 UseCase 模式处理业务逻辑
- 采用 Repository 模式进行数据访问
- 遵循三层架构：Domain → Application → Gateway

### 7.2 约束条件
- 必须符合各地数据隐私法规（GDPR、PDPA、个人信息保护法等）
- 敏感数据必须加密存储
- 跨区域数据同步必须保证数据一致性
- 系统响应时间必须满足用户体验要求

### 7.3 风险评估
- **数据安全风险**：多区域数据存储增加安全风险
- **合规风险**：各国法规变化可能导致系统不合规
- **性能风险**：跨区域数据同步可能影响系统性能
- **用户体验风险**：法律法规提示可能影响用户操作流程

## 8. 技术考虑

### 8.1 领域模型设计
- **Employee 聚合**：包含员工基本信息和条件字段
- **ConditionalField 值对象**：表示条件字段的值和类型
- **DataLocation 枚举**：表示数据存储位置（德国、新加坡、宁夏）
- **EmployeeRepository 接口**：定义员工数据访问操作

### 8.2 接口设计
- **RESTful API**：遵循 REST 设计原则
- **统一响应格式**：使用 {success, data, timestamp} 格式
- **分页接口**：使用 Pageable<T> 处理分页
- **错误处理**：统一错误码和错误信息

### 8.3 数据库设计
- **员工主表**：存储通用字段信息
- **条件字段表**：存储动态字段配置
- **字段值表**：存储员工的条件字段值
- **审计字段**：created_at, updated_at, is_deleted, creator_id, updater_id 等

### 8.4 分页与搜索设计
- **分页参数**：page（页码，从0开始）、size（每页大小，默认20）
- **搜索条件**：支持多字段组合查询
- **排序功能**：支持多字段排序
- **性能优化**：使用索引优化查询性能

### 8.5 错误码设计
- **业务错误**：400 Bad Request
- **权限错误**：403 Forbidden
- **资源不存在**：404 Not Found
- **系统错误**：500 Internal Server Error

## 9. 成功度量

### 9.1 功能性指标
- 员工列表查询响应时间 < 3 秒
- 员工搜索响应时间 < 2 秒
- 数据同步成功率 > 99%
- 系统可用性 > 99.5%

### 9.2 用户体验指标
- 用户满意度 > 85%
- 功能使用率 > 80%
- 错误率 < 1%
- 任务完成时间 < 预期时间

### 9.3 合规性指标
- 法律法规提示覆盖率 100%
- 敏感数据访问日志完整性 100%
- 数据加密覆盖率 100%
- 权限控制准确率 100%

## 10. 待决问题

### 10.1 技术问题
- 具体的数据同步机制和频率
- 脱敏规则的具体实现方式
- 法律法规提示的具体内容和形式

### 10.2 业务问题
- 各国具体需要哪些特有字段
- 不同角色的详细权限划分
- 数据备份和恢复策略

### 10.3 集成问题
- 与现有系统的集成方式
- 第三方服务的接口定义
- 数据迁移的具体方案

---

## 附录：架构合规检查清单

### 架构合规检查
- [x] Clean Architecture + DDD 分层正确（Domain / Application / Gateway）
- [x] Domain 层无框架/持久化/审计字段侵入；Repository 接口定义在 Domain
- [x] UseCase 仅有 `execute()` 且命名 `{Action}{Entity}UseCase`（写操作 `@Transactional`；读操作无事务）
- [x] DTO 输入/输出分离；分页返回 `Pageable<{Entity}PageOutput>`
- [x] Mapper 仅继承 `BaseMapper<DO>`（无自定义 SQL）；查询使用 `LambdaQueryWrapper`
- [x] Repository 继承 `ServiceImpl<Mapper, DO>`（无业务逻辑）；DO↔Domain 转换完备
- [x] 软删除 `@TableLogic` 与审计字段（created_at/updated_at/…）齐备
- [x] Controller 返回 `{success, data, timestamp}` 且不含业务逻辑
- [x] 测试覆盖：单测 ≥ 90%，集成 ≥ 80%，核心路径 100%
- [x] 术语一致：PRD/Tasks/Process 三文间的 FR/AC/任务项一一对应

### 中文合规检查
- [x] 全文为简体中文（除专有名词外无英文段落）
- [x] 标题、列表、表格均为中文表达
- [x] 关键术语与 `docs/backend/*.md` 规范中的中文术语一致